{% extends 'base.html' %}

{% block title %}Detalle de Solicitud{% endblock %}

{% block content %}
<h1 class="mb-4">Solicitud #{{ solicitud.id }}</h1>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
{% endif %}

<div class="card mb-4">
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">Creada por</dt>
            <dd class="col-sm-9">{{ solicitud.usuario_creador.username }}</dd>

            <dt class="col-sm-3">Fecha de creación</dt>
            <dd class="col-sm-9">{{ solicitud.fecha_creacion|date:'d/m/Y H:i' }}</dd>

            <dt class="col-sm-3">Descripción</dt>
            <dd class="col-sm-9">
                <div class="border rounded p-3 text-body">
                    {{ solicitud.descripcion|linebreaksbr }}
                </div>
            </dd>

            <dt class="col-sm-3">Fecha de lectura</dt>
            <dd class="col-sm-9">
                {% if solicitud.fecha_lectura %}
                    {{ solicitud.fecha_lectura|date:'d/m/Y H:i' }}
                {% else %}
                    <span class="badge bg-warning text-dark">Sin leer</span>
                {% endif %}
            </dd>

            <dt class="col-sm-3">Respuesta</dt>
            <dd class="col-sm-9">
                {% if solicitud.respuesta %}
                    <div class="border rounded p-3 bg-body-secondary text-dark">
                        {{ solicitud.respuesta|linebreaksbr }}
                    </div>
                {% else %}
                    <span class="text-muted">No hay respuesta registrada.</span>
                {% endif %}
            </dd>

            <dt class="col-sm-3">Respondido por</dt>
            <dd class="col-sm-9">
                {% if solicitud.respondido_por %}
                    {{ solicitud.respondido_por.username }}
                {% else %}
                    <span class="text-muted">—</span>
                {% endif %}
            </dd>

            <dt class="col-sm-3">Fecha de respuesta</dt>
            <dd class="col-sm-9">
                {% if solicitud.fecha_respuesta %}
                    {{ solicitud.fecha_respuesta|date:'d/m/Y H:i' }}
                {% else %}
                    <span class="text-muted">—</span>
                {% endif %}
            </dd>
        </dl>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">Responder solicitud</div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                {{ respuesta_form.respuesta.label_tag }}
                {{ respuesta_form.respuesta }}
                {% if respuesta_form.respuesta.errors %}
                    <div class="text-danger small">
                        {% for error in respuesta_form.respuesta.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>
            <button type="submit" class="btn btn-primary">Guardar respuesta</button>
        </form>
    </div>
</div>

<a class="btn btn-secondary" href="{% url 'solicitudes_info_list' %}">Volver al listado</a>
{% endblock %}
